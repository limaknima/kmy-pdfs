<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<title>PFC - Product Recipe Form</title>
<link rel="icon" type="image/ico" th:href="@{/static/favicon.ico}">
<link rel="stylesheet" type="text/css" th:href="@{/css/styles.css}" />
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.css" />
<link rel="stylesheet" type="text/css" href="//cdn.datatables.net/1.10.20/css/dataTables.material.css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/js/all.min.js"></script>
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"></script>

<script src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.10.20/js/dataTables.bootstrap4.min.js"></script>
	
<script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.8.4/moment.min.js"></script>
<script src="//cdn.datatables.net/plug-ins/1.10.22/sorting/datetime-moment.js"></script>
<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

<style>
.tableFixHead {
	overflow-y: auto;
	overflow-x: hidden;
	height: 300px;
	margin-bottom: 10px;
}

.tableFixHead thead th {
	position: sticky;
	top: 0;
	background: #F5F5F5;
	border-top: none;
	border-bottom: none;
	box-shadow: inset 0 0.1px 0 #000000, inset 0 -0.1px 0 #000000;
	border-bottom: none;
}

.formGap {
	margin-top: -20px;
}
</style>

</head>

<body class="sb-nav-fixed" onload="onPageLoad()">
	<div th:replace="/header :: navBar"></div>
	<div id="layoutSidenav">
		<div th:replace="/header :: sideNavBar"></div>
		<div id="layoutSidenav_content">
			<main>
				<div class="container-fluid" id="content">
					<br />								
					<ol class="breadcrumb mb-4">
						<li class="breadcrumb-item active" ><a th:href="@{/}"><i class="fa fa-home"></i></a></li>
						<li class="breadcrumb-item active" ><a th:href="@{/menu/recipeMenu}"><span th:text="#{menuPR}"></span></a></li>
						<li class="breadcrumb-item active" >Product Recipe Management</li>
					</ol>
					<div class="alert alert-danger alert-dismissible" th:if="${error}">
						<a class="close" data-dismiss="alert" aria-label="close">&times;</a>
						<a th:utext="${error}"></a>
					</div>
					<div class="alert alert-success alert-dismissible"
						th:if="${success}">
						<a class="close" data-dismiss="alert" aria-label="close">&times;</a>
						<a th:text="${success}"></a>
					</div>

					<div class="card">
						<div class="card-header" id="headingTwo">
							<a th:text="${header}"></a>
						</div>
						<div class="card-body">
							<form th:action="@{/main/product/productForm}" method="post"
								th:object="${productRecipeItems}" id="mainForm"
								enctype="multipart/form-data">
								<div class="d-flex justify-content-end">
									<a th:if="${screenMode == 'add'}">Status : &nbsp;Draft</a> <a
										th:if="${screenMode != 'add'}"
										th:href="@{/main/common/statusHistoryList(prId=${prId})}">
										Status : &nbsp;<span th:if="${prodRecipeStatus == 1}">Draft</span>
										<span th:if="${prodRecipeStatus == 2}">Pending
											Authorization</span> <span th:if="${prodRecipeStatus == 3}">Completed</span>
										<span th:if="${prodRecipeStatus == 4}">Rejected</span> <span
										th:if="${prodRecipeStatus == 5}">Rework</span> <span
										th:if="${prodRecipeStatus == 6}">Pending Authorization
											- rework</span> <span th:if="${prodRecipeStatus == 7}">Pending
											Confirmation</span> <span th:if="${prodRecipeStatus == 8}">Changed
											- Pending Authorization</span> <span
										th:if="${prodRecipeStatus == 9}">Changed - Pending
											Confirmation</span><span th:if="${prodRecipeStatus == 10}">Changed
											- rework</span>
									</a>
								</div>
								<ul class="nav nav-tabs" id="tab" role="tablist">
									<li class="nav-item"><a class="nav-link active" role="tab"
										data-toggle="tab" href="#productRecipeTab"
										onclick="onInitPrdRcp()">Product Recipe</a></li>
									<li class="nav-item"><a class="nav-link" data-toggle="tab"
										role="tab" href="#summaryTab" onclick="onInitSummary()">Summary</a></li>
									<li class="nav-item"><a class="nav-link" data-toggle="tab"
										role="tab" href="#qaFinalCheckerTab"
										onclick="onInitQAFinalChecker()">QA Final Check</a></li>
									<li class="nav-item"><a class="nav-link" data-toggle="tab"
										role="tab" href="#foodAdditiveTab"
										onclick="onInitFoodAdditive()">Food Additive</a></li>
									<li class="nav-item"><a class="nav-link" data-toggle="tab"
										role="tab" href="#finalDecisionTab"
										onclick="onInitFinalDecision()">Final Decision</a></li>
									<li class="nav-item"><a class="nav-link" data-toggle="tab"
										role="tab" href="#attachTab" onclick="onInitAttach()">Attachment</a></li>
									<li class="nav-item"><a class="nav-link" data-toggle="tab"
										role="tab" href="#remarkTab" onclick="onInitRemark()">Remark</a></li>
								</ul>

								<div class="tab-content">
									<div id="productRecipeTab" class="container tab-pane active">
										<br />
										<div class="form-group row">
											<label class="col-sm-3 col-form-label">Product Recipe
												TS No<a id="asterisk" style="color: red;"
												th:hidden="${asterisk}">*</a>
											</label><label class="col-form-label">:</label>
											<div class="row col-sm-4">
												<div class="col">
													<input type="text" class="form-control" id="recipeNo"
														disabled name="recipeNo" maxlength="10"
														th:field="*{prCode}">
												</div>
											</div>
										</div>
										<div class="form-group row">
											<label class="col-sm-3 col-form-label">Product Recipe
												Name <a id="asterisk" style="color: red;"
												th:hidden="${asterisk}">*</a>
											</label><!-- FSGS) Azmeer 08/03/2021 - Rename label -->
											<label class="col-form-label">:</label>
											<div class="row col-sm-9">
												<div class="col">
													<input type="text" class="form-control" id="prodName"
														disabled name="prodName" maxlength="100"
														th:field="*{prName}">
												</div>
											</div>
										</div>
										<div class="form-group row">
											<label class="col-sm-3 col-form-label">Other Name 1 </label><label
												class="col-form-label">:</label>
											<div class="row col-sm-9">
												<div class="col">
													<input type="text" class="form-control" id="otherName1"
														disabled name="otherName1" maxlength="100"
														th:field="*{prOtherName1}">
												</div>
											</div>
										</div>
										<div class="form-group row">
											<label class="col-sm-3 col-form-label">Other Name 2 </label><label
												class="col-form-label">:</label>
											<div class="row col-sm-9">
												<div class="col">
													<input type="text" class="form-control" id="otherName2"
														disabled name="otherName2" maxlength="100"
														th:field="*{prOtherName2}">
												</div>
											</div>
										</div>
										<div class="form-group row">
											<label class="col-sm-3 col-form-label">Other Name 3 </label><label
												class="col-form-label">:</label>
											<div class="row col-sm-9">
												<div class="col">
													<input type="text" class="form-control" id="otherName3"
														disabled name="otherName3" maxlength="100"
														th:field="*{prOtherName3}">
												</div>
											</div>
										</div>
										<div class="form-group row">
											<label class="col-sm-3 col-form-label">Other Name 4 </label><label
												class="col-form-label">:</label>
											<div class="row col-sm-9">
												<div class="col">
													<input type="text" class="form-control" id="otherName4"
														disabled name="otherName4" maxlength="100"
														th:field="*{prOtherName4}">
												</div>
											</div>
										</div>
										<div class="form-group row">
											<label class="col-sm-3 col-form-label">Other Name 5 </label><label
												class="col-form-label">:</label>
											<div class="row col-sm-9">
												<div class="col">
													<input type="text" class="form-control" id="otherName5"
														disabled name="otherName5" maxlength="100"
														th:field="*{prOtherName5}">
												</div>
											</div>
										</div>
										<div class="form-group row">
											<label class="col-sm-3 col-form-label">Date of
												Amendments </label><label class="col-form-label">:</label>
											<div class="row col-sm-9">
												<div class="col">
													<input type="text" class="form-control-plaintext"
														name="dateAmendments" id="dateAmendments" disabled
														th:value="${#dates.format(dateAmendments, 'dd/MM/yyy')}" />
												</div>
											</div>
										</div>
										<div class="form-group row">
											<label class="col-sm-3 col-form-label">Creator Name </label><label
												class="col-form-label">:</label>
											<div class="row col-sm-9">
												<div class="col">
													<input type="text" class="form-control-plaintext"
														id="creatorName" disabled name="creatorName"
														maxlength="100" th:value="${creatorName}">
												</div>
											</div>
										</div>
										<div class="form-group row">
											<label class="col-sm-3 col-form-label">Total
												Percentage %
											</label><label class="col-form-label">:</label>
											<div class="row col-sm-9">
												<div class="col">
													<input type="number" class="form-control-plaintext" min="0"
														id="totalPercentage" readonly max="100" step=".01"
														th:field="*{totalPerc}">
												</div>
											</div>
										</div>

										<div class="tableFixHead">
											<table class="table table-bordered" id="ingTable">
												<thead>
													<tr>
														<th class="text-left">Category</th>
														<th class="text-left">TS No</th>
														<th class="text-left">Ingredient</th>
														<th class="text-left">Alternative RM</th>
														<th class="text-left">Percentage %</th>
													</tr>
												</thead>
												<tbody>
													<tr th:each="prIngItem: ${prIngItems}">
														<td th:text="${prIngItem.categoryName}"></td>
														<td th:text="${prIngItem.selTsNo}"></td>
														<td><a href='javascript:;' th:attr="onclick='openPopupForm(\'' + ${prIngItem.refId} + ' ' + ${prIngItem.refType} + '\')'"><i class="fas fa-external-link-alt"></i></a>&nbsp;&nbsp;<a th:text="${prIngItem.ingredientName}"
															th:href="@{/main/product/productFormPRGetData(id=${prIngItem.prIngRowNo})}"></a></td>
														<td th:utext="${prIngItem.altRmNames}"></td>
														<td th:text="${prIngItem.ingPerc}"></td>
													</tr>
												</tbody>
											</table>
										</div>
										<div th:if="${updateToProductList}">
											<br>
											<label class="col-form-label" style="font-style: italic;"><i
												class="fa fa-exclamation-circle blink" style="color: orange"></i>
												Kindly make sure that information in Food Additive Tab is updated accordingly if an ingredient has been changed or added.</label>
										</div>
										

										<button class="btn btn-primary" type="submit" value="add"
											th:disabled="${productAdd}" name="productAction"
											id="btnProductAdd" style="width: 130px;">Add to List</button>
										<button class="btn btn-primary" type="submit" value="update"
											th:disabled="${productUpdate}" name="productAction"
											style="width: 130px;">Update to List</button>
										<button class="btn btn-primary" type="submit" value="delete"
											th:disabled="${productDelete}" name="productAction"
											style="width: 130px;">Delete to List</button>
										<br /> <br />

										<div class="form-group row">
											<label class="col-sm-3 col-form-label">Category <a
												id="asterisk" style="color: red;" th:hidden="${asterisk}">*</a></label><label
												class="col-form-label">:</label>
											<div class="row col-sm-3 col-form-label">
												<div class="col">
													<input type="radio" value="201" name="productCat"
														onchange="onCategoryChange()" id="rawMaterialCat"
														th:checked="${productCategory == 201}" disabled> <label
														for="rawMaterial">Raw Material</label>
												</div>
											</div>
											<div class="row col-sm-3 col-form-label">
												<div class="col">
													<input type="radio" value="301" id="productRecipeCat"
														onchange="onCategoryChange()"
														th:checked="${productCategory == 301}" name="productCat"
														disabled> <label for="productRecipe">Product
														Recipe</label>
												</div>
											</div>
										</div>
										<div class="form-group row">
											<label class="col-sm-3 col-form-label">RM / PR Name <a
												id="asterisk" style="color: red;" th:hidden="${asterisk}">*</a></label><label
												class="col-form-label">:</label>
											<div class="row col-sm-4">
												<div class="col">
													<select class="custom-select" name="rmName" id="rmName"
														disabled onchange="onRmChange()">
														<option value="0" selected hidden="true">Please
															Select</option>
														<option th:each="rawMaterialItem: ${rawMaterialItems}"
															th:value="${rawMaterialItem.rawMatlId}"
															th:text="${rawMaterialItem.rawMatlName}"
															th:selected="${rawMaterialItem.rawMatlId == refId}" />
													</select> <select class="custom-select" name="prdName"
														id="prdName" disabled onchange="onRmChange()">
														<option value="0" selected hidden="true">Please
															Select</option>
														<option th:each="productItem: ${productItems}"
															th:value="${productItem.prId}"
															th:text="${productItem.prName}"
															th:selected="${productItem.prId == refId}" />
													</select>
												</div>
												<div class="btn">
													<a onClick="onSearchModel()" class="fa fa-info-circle"
														style="position: relative; right: 15px"></a>
												</div>
											</div>
										</div>
										<div class="form-group row" id="tsNoGroup">
											<label class="col-sm-3 col-form-label">TS No <a
												id="asterisk" style="color: red;" th:hidden="${asterisk}">*</a></label><label
												class="col-form-label">:</label>
											<div class="row col-sm-4">
												<div class="col">
													<select class="custom-select" name="rmTsNo" id="rmTsNo"
														hidden="true" size="3" multiple>
														<option value="" selected hidden="true">Please
															Select</option>
														<option th:each="tsNoItem: ${tsNoItems}"
															th:value="${tsNoItem.tsNo}" th:text="${tsNoItem.tsNo}"
															th:selected="${rmTsNo != null AND rmTsNo.contains(tsNoItem.tsNo)}" />
													</select><label id="lblTSNos" class="form-control-plaintext"
														th:utext="${tsNosTxt}"></label>
													<button id="tsNoLoader" class="custom-select btn"
														type="button" disabled hidden="true">
														<span class="spinner-border spinner-border-sm"></span>
														&nbsp;Loading...
													</button>
												</div>
											</div>
										</div>
										<div class="form-group row">
											<label class="col-sm-3 col-form-label">Percentage % <a
												id="asterisk" style="color: red;" th:hidden="${asterisk}">*</a>
											</label><label class="col-form-label">:</label>
											<div class="row col-sm-4">
												<div class="col">
													<input type="number" class="form-control" min="0" max="99"
														step=".0000000001" name="ingPercentage"
														th:value="${ingPercentage}" id="ingPercentage" disabled>
													<input type="text" class="form-control" name="productRowNo"
														hidden="true" th:value="${productRowNo}">
												</div>
											</div>
										</div>
										<div class="form-group row" id="altRmDiv" th:hidden="${productCategory == 301}">
											<label class="col-sm-3 col-form-label">Alternative RM </label><label
												class="col-form-label">:</label>
											<div class="row col-sm-4">
												<div class="col">
													<select class="custom-select" name="altRm" id="altRm"
														hidden="true" size="3" multiple>
														<option value="" selected hidden="true">Please
															Select</option>
														<option th:each="altRmItem: ${rawMaterialItems}"
															th:value="${#strings.toString(altRmItem.rawMatlId)}" th:text="${altRmItem.rawMatlName}"
															th:selected="${altRm != null AND altRm.contains(#strings.toString(altRmItem.rawMatlId))}" />
													</select><label id="lblAltNames" class="form-control-plaintext"
														th:utext="${altRmNamesTxt}"></label>
												</div>
											</div>
										</div>
									</div>
									<!-- FSGS) KarVei 26/2/2021 Add - Show RM search modal -->
									<div id="rmSearchModal" class="modal fade">
										<div class="modal-dialog" style="max-width: 900px;">
											<div class="modal-content">
												<div class="modal-header">
													<h4 class="modal-title" id="classModalLabel"
														th:text="${rmSearchHeader}"></h4>
												</div>
												<div class="modal-body">
													<div class="form-group row col"
														style="margin-bottom: -15px">
														<div class="col-xs-2">
															<input id="rmInputSearch"
																class="form-control form-control-sm"
																placeholder="Search...">
														</div>
													</div>
													<br>
													<div class="tableFixHead" style="overflow-x: scroll;">
														<table class="table table-bordered text-nowrap"
															id="idTableOnlySearchRM">
															<thead>
																<tr>
																	<th>Raw Material &emsp;</th>
																	<th>TS No &emsp;</th>
																	<th>Manufacturer</th>
																	<th>Supplier</th>
																	<th>VIPD Date &emsp;</th>
																	<th>Declaration Date &emsp;</th>
																	<th>INS</th>
																	<th>FEMA No &emsp;</th>
																	<th>JECFA No &emsp;</th>
																	<th>GMO &emsp;</th>
																	<th>Flavor Status &emsp;</th>
																	<th>Status &emsp;</th>
																	<th>Created Date &emsp;</th>
																</tr>
															</thead>
															<tbody id="rmTable">
																<tr th:each="rmList: ${materialLists}">
																	<td><a th:text="${rmList.rawMatlName}"></a></td>
																	<td th:utext="${rmList.tsNoManufacturer}"></td>
																	<td th:utext="${rmList.manufacturer}"></td>
																	<td th:utext="${rmList.supplier}"></td>
																	<td th:utext="${rmList.vipdDate}"></td>
																	<td th:utext="${rmList.vipdAnnex2Date}"></td>
																	<td th:text="${rmList.insNo}"></td>
																	<td th:text="${rmList.femaNo}"></td>
																	<td th:text="${rmList.jecfaNo}"></td>
																	<td th:text="${rmList.gmoStatus}"></td>
																	<td th:text="${rmList.flavorStatus}"></td>
																	<td><span th:if="${rmList.recordStatus == 1}">Draft</span>
																		<span th:if="${rmList.recordStatus == 2}">Pending
																			Authorization</span> <span
																		th:if="${rmList.recordStatus == 3}">Completed</span> <span
																		th:if="${rmList.recordStatus == 4}">Reject</span> <span
																		th:if="${rmList.recordStatus == 5}">Rework</span> <span
																		th:if="${rmList.recordStatus == 6}">Pending
																			Authorization - rework</span> <span
																		th:if="${rmList.recordStatus == 8}">Changed -
																			Pending Authorization</span> <span
																		th:if="${rmList.recordStatus == 10}">Changed -
																			rework</span></td>
																	<td
																		th:text="${#dates.format(rmList.createdDate, 'dd/MM/yyy hh:mm:ss a')}"></td>
																</tr>
															</tbody>
														</table>
													</div>
												</div>
												<div class="modal-footer">
													<button type="button" class="btn btn-primary"
														data-dismiss="modal">Close</button>
												</div>
											</div>
										</div>
									</div>
									<!-- FSGS) KarVei 26/2/2021 Add - Show PR search modal -->
									<div id="prSearchModal" class="modal fade">
										<div class="modal-dialog" style="max-width: 900px;">
											<div class="modal-content">
												<div class="modal-header">
													<h4 class="modal-title" id="classModalLabel"
														th:text="${prSearchHeader}"></h4>
												</div>
												<div class="modal-body">
													<div class="form-group row col"
														style="margin-bottom: -15px">
														<div class="col-xs-2">
															<input id="prInputSearch"
																class="form-control form-control-sm"
																placeholder="Search...">
														</div>
													</div>
													<br>
													<div class="tableFixHead" style="overflow-x: scroll;">
														<table class="table table-bordered text-nowrap"
															id="idTableOnlySearchPR">
															<thead>
																<tr>
																	<th>Product Recipe Name &emsp;</th>
																	<th>Product Recipe TS No &emsp;</th>
																	<th>Ingredient</th>
																	<th>Final Permissibility Status &emsp;</th>
																	<th>Status &emsp;</th>
																</tr>
															</thead>
															<tbody id="prTable">
																<tr th:each="prList: ${prModal}">
																	<td><a th:text="${prList.prName}"></a></td>
																	<td th:text="${prList.prCode}"></td>
																	<td th:utext="${prList.ingredientName}"></td>
																	<td><span th:if="${prList.numberPermitted != 0}">
																			<a th:text="${prList.numberPermitted}"></a> <span
																			th:if="${prList.numberPermitted != 0}">Permitted</span>
																	</span> <span th:if="${prList.numberNotPermitted != 0}">
																			<span th:if="${prList.numberPermitted != 0}">,</span>
																			<a th:text="${prList.numberNotPermitted}"
																			th:href="@{/main/product/productListStatus2(prId=${prList.prId},prName=${prList.prName})}"></a>
																			<span th:if="${prList.numberNotPermitted != 0}">Not
																				Permitted</span>
																	</span> <span th:if="${prList.numberNotSure != 0}"> <span
																			th:if="${prList.numberNotPermitted != 0 or prList.numberPermitted != 0}">,</span>
																			<a th:text="${prList.numberNotSure}"></a> <span
																			th:if="${prList.numberNotSure != 0}">Not Sure</span>
																	</span></td>
																	<td><span th:if="${prList.recordStatus == 1}">Draft</span>
																		<span th:if="${prList.recordStatus == 2}">Pending
																			Authorization</span> <span
																		th:if="${prList.recordStatus == 3}">Completed</span> <span
																		th:if="${prList.recordStatus == 4}">Reject</span> <span
																		th:if="${prList.recordStatus == 5}">Rework</span> <span
																		th:if="${prList.recordStatus == 6}">Pending
																			Authorization - rework</span> <span
																		th:if="${prList.recordStatus == 7}">Pending
																			Confirmation</span> <span
																		th:if="${prList.recordStatus == 8}">Changed -
																			Pending Authorization</span> <span
																		th:if="${prList.recordStatus == 9}">Changed -
																			Pending Confirmation</span> <span
																		th:if="${prList.recordStatus == 10}">Changed -
																			rework</span></td>
																</tr>
															</tbody>
														</table>
													</div>
												</div>
												<div class="modal-footer">
													<button type="button" class="btn btn-primary"
														data-dismiss="modal">Close</button>
												</div>
											</div>
										</div>
									</div>
									<div id="summaryTab" class="container tab-pane fade">
										<br />
										<div class="form-group row">
											<label class="col-sm-3 col-form-label">Product Recipe TS No</label><label class="col-form-label">:</label>
											<div class="row col-sm-4">
												<div class="col">
													<input type="text" disabled class="form-control-plaintext"
														name="recipeNoDisplay" th:value="${recipeNo}">
												</div>
											</div>
										</div>
										<div class="form-group row">
											<label class="col-sm-3 col-form-label">Product Recipe
												Name </label><label class="col-form-label">:</label><!-- FSGS) Azmeer 08/03/2021 - Rename label -->
											<div class="row col-sm-9">
												<div class="col">
													<input type="text" disabled class="form-control-plaintext"
														name="prodNameDisplay" th:value="${prodName}">
												</div>
											</div>
										</div>
										<div class="form-group row">
											<label class="col-sm-3 col-form-label">Total
												Percentage % </label><label class="col-form-label">:</label>
											<div class="row col-sm-4">
												<div class="col">
													<input type="number" disabled
														class="form-control-plaintext"
														name="totalPercentageDisplay"
														th:value="${totalPercentage}">
												</div>
											</div>
										</div>
										<div class="form-group row">
											<label class="col-sm-3 col-form-label">Final Flavor Status
											</label><label class="col-form-label">:</label>
											<div class="row col-sm-9">
												<div class="col">
													<input type="text" class="form-control-plaintext"
														id="prFlavorStatus" readonly 
														th:field="*{flavStatusName}">
												</div>
											</div>
										</div>
										<div class="tableFixHead" style="height: 800px;">
											<table class="table table-bordered">
												<thead>
													<tr>
														<th class="text-left">Category</th>
														<th class="text-left">TS No</th>
														<th class="text-left">Ingredient</th>
														<th class="text-left">RM Flavor Status</th>
														<th class="text-left">Alternative RM</th>
														<!-- FSGS) Azmeer 04/03/2021 - Add asterik -->
														<th class="text-left">Percentage % <a id="asterisk"
															style="color: red;" th:hidden="${asterisk}">*</a></th>
														<!-- FSGS) Azmeer 04/03/2021 - Add asterik -->
													</tr>
												</thead>
												<tbody>
													<tr th:each="ingSummary: ${ingSummaryItems}">
														<td th:text="${ingSummary.categoryName}"></td>
														<td th:text="${ingSummary.selTsNo}"></td>
														<td th:utext="${ingSummary.ingredientName}"></td>
														<td th:utext="${ingSummary.rmFlavStatusName}"></td>
														<td th:utext="${ingSummary.altRmNames}"></td>
														<td align="right"
															th:text="${#numbers.formatDecimal(ingSummary.ingPerc, 1, 10, 'POINT')}"></td>
													</tr>
												</tbody>
											</table>
										</div>
										<br /> <br />
									</div>

									<div id="qaFinalCheckerTab" class="container tab-pane fade">
										<br />
										<div class="form-group row">
											<label class="col-sm-3 col-form-label">Product Recipe TS No</label><label class="col-form-label">:</label>
											<div class="row col-sm-4">
												<div class="col">
													<input type="text" disabled class="form-control-plaintext"
														name="recipeNoDisplay" th:value="${recipeNo}">
												</div>
											</div>
										</div>
										<div class="form-group row">
											<label class="col-sm-3 col-form-label">Product Recipe
												Name </label><label class="col-form-label">:</label><!-- FSGS) Azmeer 08/03/2021 - Rename label -->
											<div class="row col-sm-9">
												<div class="col">
													<input type="text" disabled class="form-control-plaintext"
														name="prodNameDisplay" th:value="${prodName}">
												</div>
											</div>
										</div>
										<div class="form-group row">
											<label class="col-sm-3 col-form-label">Total
												Percentage % </label><label class="col-form-label">:</label>
											<div class="row col-sm-4">
												<div class="col">
													<input type="text" disabled class="form-control-plaintext"
														name="totalPercentageDisplay"
														th:value="${totalPercentage}">
												</div>
											</div>
										</div>

										<div th:if="${affectedCountry}">
											<label class="col-form-label" style="font-style: italic;"><i
												class="fa fa-exclamation-circle blink" style="color: red"></i>
												<a th:utext="${affectedCountry}"></a></label>
										</div>
										<div class="tableFixHead">
											<table class="table table-bordered">
												<thead>
													<tr>
														<th>Country</th>
														<!-- FSGS) Azmeer 04/03/2021 - Add asterik -->
														<th>Final Permissibility Status <a id="asterisk"
															style="color: red;" th:hidden="${asterisk}">*</a></th>
														<!-- FSGS) Azmeer 04/03/2021 - Add asterik -->
													</tr>
												</thead>
												<tbody>
													<tr th:each="prStatItem: ${prStatItems}">
														<td><a th:text="${prStatItem.countryName}"
															th:href="@{/main/product/productFormFCGetData(id=${prStatItem.prStatRowNo})}"></a></td>
														<td th:text="${prStatItem.finalStatusDesc}"></td>
													</tr>
												</tbody>
											</table>
										</div>

										<button class="btn btn-primary" type="submit" value="add"
											th:disabled="${prStatAdd}" name="prStatAction"
											id="btnPrStatAdd" style="width: 130px;">Add to List</button>
										<button class="btn btn-primary" type="submit" value="update"
											th:disabled="${prStatUpdate}" name="prStatAction"
											style="width: 130px;">Update to List</button>
										<button class="btn btn-primary" type="submit" value="delete"
											th:disabled="${prStatDelete}" name="prStatAction"
											style="width: 130px;">Delete to List</button>
										<br /> <br />

										<div class="form-group row">
											<label class="col-sm-3 col-form-label">Country <a
												id="asterisk" style="color: red;" th:hidden="${asterisk}">*</a>
											</label><label class="col-form-label">:</label>
											<div class="row col-sm-4">
												<div class="col">
													<select class="custom-select" name="prStatCountryId"
														id="prStatCountryId" disabled onchange="onCountryChange()">
														<option value="" selected hidden="true">Please
															Select</option>
														<option th:each="countryItem: ${countryItems}"
															th:value="${countryItem.countryId}"
															th:text="${countryItem.countryName}"
															th:selected="${countryItem.countryId==prStatCountryId}" />
													</select> <input type="text" class="form-control" name="prStatRowNo"
														hidden="true" th:value="${prStatRowNo}" />
												</div>
											</div>
											<label class="col-sm-3 col-form-label">Final
												Permissibility Status <a id="asterisk" style="color: red;"
												th:hidden="${asterisk}">*</a>
											</label>
											<!-- FSGS) Azmeer 04/03/2021 - Add asterik -->
											<label class="col-form-label">:</label>
											<div class="row col-sm-2">
												<div class="col">
													<input type="text" readonly class="form-control-plaintext"
														id="prAutoStatus" name="prAutoStatus"
														th:value="${prAutoStatus}" />
												</div>
											</div>
											<!-- FSGS) KarVei 2/3/2021 Add - Icon Label -->
											<div class="row col-sm-6">
												<div class="col">
													<br>
													<label class="col-form-label" style="font-style: italic;"><i
														class="fa fa-exclamation-circle" style="color: orange"></i>
														Selected ingredient has more than one TS-No</label>
												</div>
											</div>
										</div>

										<div class="tableFixHead">
											<table class="table table-bordered" id="ingDetailTable">
												<thead>
													<tr>
														<th class="text-left"></th>
														<th class="text-left">Ingredient</th>
														<th class="text-left">Percentage %</th>
														<th class="text-left">Final Status
														<th class="text-left">(NEW) Final Status</th>
														<th class="text-left">Remarks</th>
													</tr>
												</thead>
												<tbody>
													<tr th:each="prRmStatItem: ${prRmStatItems}">
														<!-- FSGS) KarVei 2/3/2021 Add - Show Icon if more than 1 TS No Start -->
														<td th:switch="${prRmStatItem.TSNo}">
															<div th:case="${prRmStatItem.TSNo == true}"
																class="icon hidden-xs">
																<i class="fa fa-exclamation-circle"
																	style="color: orange"></i>
															</div>
															<div th:case="${prRmStatItem.TSNo == false}"></div>
														</td>
														<!-- FSGS) KarVei 2/3/2021 Add - Show Icon if more than 1 TS No End -->
														<td><a href='javascript:;'
															th:text="${prRmStatItem.productName}"
															th:attr="onclick='onProductNameClick(\'' + ${prRmStatItem.productName} + '\')'"></a>
															<div th:if="${prRmStatItem.affectedFlag != null && prRmStatItem.affectedFlag == 'Y'}">
																<label class="col-form-label" style="font-style: italic;">
																	<i class="fa fa-exclamation-circle blink" style="color: red">
																	</i> Impacted due to Final Status changed
																</label>															
															</div>
														</td>
														<td align="right"
															th:text="${#numbers.formatDecimal(prRmStatItem.totalPerc, 1, 10, 'POINT')}"></td>
														<td th:text="${prRmStatItem.sysFinalStatusName}"></td>
														<td><select class="custom-select" disabled
															name="finalStatus" onchange="onFinalStatusChange()">
																<option value="0" selected hidden="true">Please
																	Select</option>
																<option value="1"
																	th:selected="${prRmStatItem.finalStatus==1}">Permitted</option>
																<option value="2"
																	th:selected="${prRmStatItem.finalStatus==2}">Not
																	Permitted</option>
																<option value="3"
																	th:selected="${prRmStatItem.finalStatus==3}">Not
																	Sure</option>
																<option value="4"
																	th:selected="${prRmStatItem.finalStatus==4}">N/A</option>
														</select></td>
														<td><textarea class="form-control"
																name="remarksQaFinalChecker" disabled
																th:text="${prRmStatItem.remarks}"></textarea></td>
													</tr>
												</tbody>
											</table>
										</div>
									</div>

									<div id="foodAdditiveTab" class="container tab-pane fade">
										<br />
										<div class="form-group row">
											<label class="col-sm-3 col-form-label">Product Recipe TS No</label><label class="col-form-label">:</label>
											<div class="row col-sm-4">
												<div class="col">
													<input type="text" disabled class="form-control-plaintext"
														name="recipeNoDisplay" th:value="${recipeNo}">
												</div>
											</div>
										</div>
										<div class="form-group row">
											<label class="col-sm-3 col-form-label">Product Recipe
												Name </label><label class="col-form-label">:</label><!-- FSGS) Azmeer 08/03/2021 - Rename label -->
											<div class="row col-sm-9">
												<div class="col">
													<input type="text" disabled class="form-control-plaintext"
														name="prodNameDisplay" th:value="${prodName}">
												</div>
											</div>
										</div>
										<div class="form-group row">
											<label class="col-sm-3 col-form-label">Total
												Percentage % </label><label class="col-form-label">:</label>
											<div class="row col-sm-4">
												<div class="col">
													<input type="text" disabled class="form-control-plaintext"
														name="totalPercentageDisplay"
														th:value="${totalPercentage}">
												</div>
											</div>
										</div>

										<div class="tableFixHead">
											<table class="table table-bordered">
												<thead>
													<tr>
														<th></th>
														<th>Raw Material Name</th>
														<th>Food Additive Function</th>
													</tr>
												</thead>
												<tbody>
													<tr th:each="prRmAdditiveItem: ${prRmAdditiveItems}">
														<td>
															<div th:if="${prRmAdditiveItem.changed}">
																<label class="col-form-label"
																	style="font-style: italic;"><i
																	class="fa fa-exclamation-circle blink"
																	style="color: orange" title="Kindly make sure this information is updated if an ingredient has been changed or added."></i></label>
															</div>
														</td>
														<td><a th:text="${prRmAdditiveItem.productName}"
															th:href="@{/main/product/productFormFAGetData(id=${prRmAdditiveItem.prRmAdditiveRowNo})}"></a></td>
														<td th:text="${prRmAdditiveItem.additiveDesc}"></td>
													</tr>
												</tbody>
											</table>
										</div>

										<button class="btn btn-primary" type="submit" value="add"
											th:disabled="${foodAdditiveAdd}" name="foodAdditiveAction"
											id="btnFoodAdditiveAdd" style="width: 130px;">Add to
											List</button>
										<button class="btn btn-primary" type="submit" value="update"
											th:disabled="${foodAdditiveUpdate}" name="foodAdditiveAction"
											style="width: 130px;">Update to List</button>
										<button class="btn btn-primary" type="submit" value="delete"
											th:disabled="${foodAdditiveDelete}" name="foodAdditiveAction"
											style="width: 130px;">Delete to List</button>
										<br /> <br />

										<div class="form-group row">
											<label class="col-sm-3 col-form-label">Ingredient <a
												id="asterisk" style="color: red;" th:hidden="${asterisk}">*</a></label><label
												class="col-form-label">:</label>
											<div class="row col-sm-4">
												<div class="col">
													<select class="custom-select" name="ingredientName"
														id="ingredientName" disabled>
														<option value="0" selected hidden="true">Please
															Select</option>
														<option th:each="ingDropDown: ${ingDropDownItems}"
															th:value="${ingDropDown.refId}"
															th:text="${ingDropDown.ingredientName}"
															th:selected="${ingDropDown.refId == ingredientId}" />
													</select> <input hidden="true" name="prRmAdditiveRowNo"
														th:value="${prRmAdditiveRowNo}">
												</div>
											</div>
										</div>

										<div class="form-group row">
											<label class="col-sm-3 col-form-label">Food Additive
												Function</label> <label class="col-form-label">:</label>
											<div class="row col-sm-7">
												<div class="col">
													<textarea class="form-control" maxlength="500" rows="3"
														style="resize: none;" name="foodAdditiveFunc"
														id="foodAdditiveFunc" disabled
														th:text="${foodAdditiveFunc}"></textarea>
												</div>
											</div>
										</div>
									</div>

									<div id="finalDecisionTab" class="container tab-pane fade">
										<br />
										<div class="form-group row">
											<label class="col-sm-3 col-form-label">Product Recipe TS No</label><label class="col-form-label">:</label>
											<div class="row col-sm-4">
												<div class="col">
													<input type="text" disabled class="form-control-plaintext"
														name="recipeNoDisplay" th:value="${recipeNo}">
												</div>
											</div>
										</div>
										<div class="form-group row">
											<label class="col-sm-3 col-form-label">Product Recipe
												Name </label><label class="col-form-label">:</label><!-- FSGS) Azmeer 08/03/2021 - Rename label -->
											<div class="row col-sm-9">
												<div class="col">
													<input type="text" disabled class="form-control-plaintext"
														name="prodNameDisplay" th:value="${prodName}">
												</div>
											</div>
										</div>
										<div class="form-group row">
											<label class="col-sm-3 col-form-label">Total
												Percentage % </label><label class="col-form-label">:</label>
											<div class="row col-sm-4">
												<div class="col">
													<input type="text" disabled class="form-control-plaintext"
														name="totalPercentageDisplay"
														th:value="${totalPercentage}">
												</div>
											</div>
										</div>

										<div class="tableFixHead">
											<table class="table table-bordered">
												<thead>
													<tr>
														<th width="40px">Regulation</th>
														<th>Country</th>
														<th>Final Permissibility Status</th>
														<th>HOD Remark</th>
													</tr>
												</thead>
												<tbody>
													<tr th:each="prStatItem: ${prStatItems}">
														<td align="center"><a
															th:href="@{/main/product/productFormRegGetData(id=${prStatItem.CountryId})}"><i
																class="fa fa-info-circle" aria-hidden="true"></i></a></td>
														<td th:text="${prStatItem.countryName}"></td>
														<td th:text="${prStatItem.finalStatusDesc}"></td>
														<td><textarea class="form-control" disabled
																th:text="${prStatItem.remarks}"
																name="remarksFinalDecision" maxlength="500"></textarea>
														</td>
													</tr>
												</tbody>
											</table>
										</div>

										<div id="classModal" class="modal fade">
											<div class="modal-dialog" style="max-width: 900px;">
												<div class="modal-content">
													<div class="modal-header">
														<h4 class="modal-title" id="classModalLabel"
															th:text="${regHeader}"></h4>
													</div>
													<div class="modal-body">
														<div id="newSearchPlace"></div>

														<div class="tableFixHead">
															<table class="table table-bordered"
																id="idTableOnlySearch">
																<thead>
																	<tr>
																		<th>Ingredient</th>
																		<th>Country</th>
																		<th>Regulation</th>
																		<th>Reference</th>
																		<th>Remark</th>
																	</tr>
																</thead>
																<tbody>
																	<tr th:each="countryReg: ${countryRegItems}">
																		<td th:text="${countryReg.infoRmName}"></td>
																		<td th:text="${countryReg.country}"></td>
																		<td> 
																			<a th:text="${countryReg.fileName}" th:href="@{/main/product/productFormDownloadRegFile(id=${countryReg.reglFileId})}"></a>
																		</td>
																		<td><span> <span
																				th:text="${countryReg.refUrl1}"
																				th:value="${countryReg.refUrl1}"> </span> <br /> <span
																				th:if="${countryReg.refUrl2 != ''}"
																				th:text=${countryReg.refUrl2}
																				th:value=${countryReg.refUrl2}> </span> <span
																				th:if="${countryReg.refUrl2 != ''}"> <br />

																			</span> <span th:if="${countryReg.refUrl3 != ''}"
																				th:text=${countryReg.refUrl3}
																				th:value=${countryReg.refUrl3}></span> <span
																				th:if="${countryReg.refUrl3 != ''}"><br /></span> <span
																				th:if="${countryReg.refUrl4 != ''}"
																				th:text=${countryReg.refUrl4}
																				th:value=${countryReg.refUrl3}></span> <span
																				th:if="${countryReg.refUrl4 != ''}"><br /></span> <span
																				th:if="${countryReg.refUrl5 != ''}"
																				th:text=${countryReg.refUrl5}
																				th:value=${countryReg.refUrl3}></span>
																		</span></td>
																		<td th:text="${countryReg.remarks}"></td>
																	</tr>
																</tbody>
															</table>
														</div>
													</div>
													<div class="modal-footer">
														<button type="button" class="btn btn-primary"
															data-dismiss="modal">Close</button>
													</div>
												</div>
											</div>
										</div>

									</div>
									
									<div id="remarkTab" class="container tab-pane fade">
										<br />
										<div class="form-group row">
											<label class="col-sm-3 col-form-label">Product Recipe TS No</label><label class="col-form-label">:</label>
											<div class="row col-sm-4">
												<div class="col">
													<input type="text" disabled class="form-control-plaintext"
														name="recipeNoDisplay" th:value="${recipeNo}">
												</div>
											</div>
										</div>
										<div class="form-group row">
											<label class="col-sm-3 col-form-label">Product Recipe
												Name </label><label class="col-form-label">:</label><!-- FSGS) Azmeer 08/03/2021 - Rename label -->
											<div class="row col-sm-9">
												<div class="col">
													<input type="text" disabled class="form-control-plaintext"
														name="prodNameDisplay" th:value="${prodName}">
												</div>
											</div>
										</div>
										<div class="form-group row">
											<label class="col-sm-3 col-form-label">Remark </label> <label
												class="col-form-label">:</label>
											<div class="row col-sm-7">
												<div class="col">
													<textarea class="form-control" maxlength="500" rows="3"
														style="resize: none;" id="remark" disabled
														th:field="*{remarks}"></textarea>
												</div>
											</div>
										</div>
									</div>

									<div id="attachTab" class="container tab-pane fade">
										<br />
										<div class="form-group row">
											<label class="col-sm-3 col-form-label">Product Recipe TS No</label><label class="col-form-label">:</label>
											<div class="row col-sm-4">
												<div class="col">
													<input type="text" disabled class="form-control-plaintext"
														name="recipeNoDisplay" th:value="${recipeNo}">
												</div>
											</div>
										</div>
										<div class="form-group row">
											<label class="col-sm-3 col-form-label">Product Recipe
												Name </label><label class="col-form-label">:</label><!-- FSGS) Azmeer 08/03/2021 - Rename label -->
											<div class="row col-sm-9">
												<div class="col">
													<input type="text" disabled class="form-control-plaintext"
														name="prodNameDisplay" th:value="${prodName}">
												</div>
											</div>
										</div>

										<div id="newSearchPlace"></div>
										<div class="tableFixHead">
											<table class="table table-bordered">
												<thead>
													<tr>
														<th class="text-left">Title</th>
														<th class="text-left">File Name</th>
														<th class="text-left">Category</th>
														<th class="text-left">Owner</th>
													</tr>
												</thead>
												<tbody>
													<tr th:each="attach : ${attachItems}">
														<td><a
															th:href="@{/main/product/productFormDocGetData(id=${attach.docRowNo})}"
															th:text="${attach.subject}"></a></td>
														<td><a
															th:href="@{/main/product/productFormDocDwn(id=${attach.docRowNo})}"
															th:text="${attach.fileName}"></a></td>
														<td th:text="${attach.docTypeName}"></td>
														<td th:text="${attach.createdBy}"></td>
													</tr>
												</tbody>
											</table>
										</div>

										<button class="btn btn-primary" type="submit" value="add"
											th:disabled="${attachAdd}" name="attachAction"
											id="btnAttachAdd" style="width: 130px;">Add to List</button>
										<button class="btn btn-primary" type="submit" value="update"
											th:disabled="${attachUpdate}" name="attachAction"
											style="width: 130px;">Update to List</button>
										<button class="btn btn-primary" type="submit" value="delete"
											th:disabled="${attachDelete}" name="attachAction"
											style="width: 130px;">Delete to List</button>
										<br /> <br />

										<div class="form-group row">
											<label class="col-sm-2 col-form-label">Title <a
												id="asterisk" style="color: red;" th:hidden="${asterisk}">*</a></label>
											<label class="col-form-label">:</label>
											<div class="row col-sm-5">
												<div class="col">
													<input type="text" class="form-control" id="attachTitle"
														maxlength="50" th:value="${attachTitle}"
														name="attachTitle" disabled> <input type="text"
														hidden="true" name="attachRow" th:value="${attachRow}">
												</div>
											</div>
										</div>
										<div class="form-group row">
											<label class="col-sm-2 col-form-label">Category <a
												id="asterisk" style="color: red;" th:hidden="${asterisk}">*</a></label>
											<label class="col-form-label">:</label>
											<div class="row col-sm-5">
												<div class="col">
													<select class="custom-select" id="attachCategory"
														name="attachCategory" disabled>
														<option value="0" selected hidden="true">Please
															Select</option>
														<option th:each="categoryList : ${documentType}"
															th:value="${categoryList.id}"
															th:selected="${categoryList.id == attachCategory}"
															th:text="${categoryList.name}">
													</select>
												</div>
											</div>
										</div>
										<div class="form-group row">
											<label class="col-sm-2 col-form-label">File <a
												id="asterisk" style="color: red;" th:hidden="${asterisk}">*</a></label>
											<label class="col-form-label">:</label>
											<div class="row col-sm-5">
												<div class="col">
													<div class="custom-file">
														<input type="file" class="custom-file-input btn" disabled
															hidden="true" id="attachFile" placeholder="Choose file"
															name="attachFile" multiple></input> <label
															id="attachFileLabel" hidden="true"
															class="custom-file-label" for="files">Choose file</label>
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>

								<div class="modal fade" id="rejectModal" tabindex="-1"
									role="dialog" aria-hidden="true">
									<div class="modal-dialog" role="document">
										<div class="modal-content">
											<div class="modal-header">
												<h5 class="modal-title">Reject Product Recipe</h5>
												<button type="button" class="close" data-dismiss="modal"
													aria-label="Close">
													<span aria-hidden="true">&times;</span>
												</button>
											</div>
											<div class="modal-body">
												<div class="form-group">
													<label class="col-form-label">Product Recipe Name :</label>
													<input type="text" disabled class="form-control"
														th:value="*{prName}">
												</div>
												<div class="form-group">
													<label class="col-form-label">Remarks <a
														id="asterisk" style="color: red;">*</a>:</label>
													<textarea class="form-control"  name="rejectRemark"></textarea>
													<span>* Reject Remarks is mandatory as it will be used for tracing reason of change/update</span>
												</div>
											</div>
											<div class="modal-footer">
												<button type="submit" class="btn btn-primary" value="reject"
													name="action">Confirm</button>
												<button type="button" class="btn btn-secondary"
													data-dismiss="modal">Close</button>
											</div>
										</div>
									</div>
								</div>

								<div class="modal fade" id="reworkModal" tabindex="-1"
									role="dialog" aria-hidden="true">
									<div class="modal-dialog" role="document">
										<div class="modal-content">
											<div class="modal-header">
												<h5 class="modal-title">Rework Product Recipe</h5>
												<button type="button" class="close" data-dismiss="modal"
													aria-label="Close">
													<span aria-hidden="true">&times;</span>
												</button>
											</div>
											<div class="modal-body">
												<div class="form-group">
													<label class="col-form-label">Product Recipe Name :</label>
													<input type="text" disabled class="form-control"
														th:value="*{prName}">
												</div>
												<div class="form-group">
													<label class="col-form-label">Remarks <a
														id="asterisk" style="color: red;">*</a>:</label>
													<textarea class="form-control"  name="reworkRemark"></textarea>
													<span>* Rework Remarks is mandatory as it will be used for tracing reason of change/update</span>
												</div>
											</div>
											<div class="modal-footer">
												<button type="submit" class="btn btn-primary" value="rework"
													name="action">Confirm</button>
												<button type="button" class="btn btn-secondary"
													data-dismiss="modal">Close</button>
											</div>
										</div>
									</div>
								</div>
								
								<div class="modal fade" id="submitConfirmDialog" tabindex="-1"
									role="dialog" aria-hidden="true">
									<div class="modal-dialog modal-dialog-centered" role="document">
										<div class="modal-content">
											<div class="modal-header">
												<h5 class="modal-title">Submit Confirmation</h5>
												<button type="button" class="close" data-dismiss="modal"
													aria-label="Close">
													<span aria-hidden="true">&times;</span>
												</button>
											</div>
											<div class="modal-body">
												Are you sure to submit this	record?
												<div class="form-group">
													<label class="col-form-label">Product Recipe Name :</label>
													<input type="text" disabled class="form-control"
														th:value="*{prName}">
												</div>
												<div class="form-group" th:if="${screenMode != 'add'}" >
													<label class="col-form-label">Traceability Remarks <a
														id="asterisk" style="color: red;">*</a>:</label>
													<textarea class="form-control"  name="submitConfirmRemark1"></textarea>
													<span>* Traceability Remarks is mandatory as it will be used for tracing reason of change/update</span>
												</div>	
											</div>
											<div class="modal-footer">
												<button type="submit" class="btn btn-primary" form="mainForm"
													value="submit" name="action">Confirm</button>
												<button type="button" class="btn btn-secondary"
													data-dismiss="modal">Cancel</button>
											</div>
										</div>
									</div>
								</div>

								<div class="modal fade" id="hodRemarkModal" tabindex="-1"
									role="dialog" aria-hidden="true">
									<div class="modal-dialog" role="document"
										style="max-width: 900px;">
										<div class="modal-content">
											<div class="modal-header">
												<h5 class="modal-title">Submit Confirmation - HOD
													Regulation Remark</h5>
												<button type="button" class="close" data-dismiss="modal"
													aria-label="Close">
													<span aria-hidden="true">&times;</span>
												</button>
											</div>
											<div class="modal-body">
												<div th:if="${affectedCountry}">
													<label class="col-form-label" style="font-style: italic;"><i
														class="fa fa-exclamation-circle blink" style="color: red"></i>
														<a th:utext="${affectedCountry}"></a></label>
												</div>
												<div class="tableFixHead">
													<table class="table table-bordered" id="hodStatusTable">
														<thead>
															<tr>
																<th>Country</th>
																<th>Final Permissibility Status</th>
																<th>New Final Permissibility Status</th>
																<th>HOD Remark</th>
															</tr>
														</thead>
														<tbody>
															<tr th:each="prStatItem: ${prStatItems}">
																<td th:text="${prStatItem.countryName}"></td>
																<td th:text="${prStatItem.finalStatusDesc}"></td>
																<td></td>
																<td><textarea class="form-control" name="remarksFinalDecisionSubmit"
																	th:text="${prStatItem.remarks}" maxlength="500"></textarea>
																	<div th:if="${prStatItem.affectedFlag != null && prStatItem.affectedFlag == 'Y'}">
																		<label class="col-form-label" style="font-style: italic;">
																			<i class="fa fa-exclamation-circle blink" style="color: red"></i>
																		</label> Impacted due to Final Status changed										
																	</div>		
																</td>
															</tr>
														</tbody>
													</table>
												</div>
												
											</div>
											<div class="modal-body">
												Are you sure to submit this	record?
												<div class="form-group">
													<label class="col-form-label">Product Recipe Name :</label>
													<input type="text" disabled class="form-control"
														th:value="*{prName}">
												</div>
												<div class="form-group" th:if="${screenMode != 'add'}" >
													<label class="col-form-label">Traceability Remarks <a
														id="asterisk" style="color: red;">*</a>:</label>
													<textarea class="form-control" name="submitConfirmRemark2"></textarea>
													<span>* Traceability Remarks is mandatory as it will be used for tracing reason of change/update</span>
												</div>	
											</div>
											<div class="modal-footer">
												<button type="submit" class="btn btn-primary"
													form="mainForm" value="submit" name="action">Confirm</button>
												<button type="button" class="btn btn-secondary"
													data-dismiss="modal">Close</button>
											</div>
										</div>
									</div>
								</div>

								<div class="modal fade" id="rawMatlRegulationModal"
									tabindex="-1" role="dialog" aria-hidden="true">
									<div class="modal-dialog" role="document"
										style="max-width: 900px;">
										<div class="modal-content">
											<div class="modal-header">
												<h4 class="modal-title">
													Selection Regulation for Raw Material : <a id="rawMatlReg"></a>
												</h4>
												<button type="button" class="close" data-dismiss="modal"
													aria-label="Close">
													<span aria-hidden="true">&times;</span>
												</button>
											</div>
											<div class="modal-body">
												<div class="form-group row">
													<label class="col-sm-2 col-form-label control-label">Ingredient</label>
													<div class="row col-sm-5">
														<label class="col-form-label">:</label>
														<div class="col">
															<a id="rawMatlIng" class="form-control-plaintext"></a>
														</div>
													</div>
												</div>
												<div class="form-group row formGap">
													<label class="col-sm-2 col-form-label control-label">Country</label>
													<div class="row col-sm-3">
														<label class="col-form-label">:</label>
														<div class="col">
															<a id="rawMatlRegCountry" class="form-control-plaintext"></a>
														</div>
													</div>
													<label class="col-sm-2 col-form-label control-label">Final
														Status</label>
													<div class="row col-sm-3">
														<label class="col-form-label">:</label>
														<div class="col">
															<a id="rawMatlRegFinal" class="form-control-plaintext"></a>
														</div>
													</div>
												</div>

												<div class="tableFixHead">
													<table class="table table-bordered" id="ingRegTable">
														<thead>
															<tr>
																<th class="text-left">TS No</th>
																<th class="text-left">Raw Material Name</th>
																<th class="text-left">INS</th>
																<th class="text-left">E No</th>
																<th class="text-left">FEMA No</th>
																<th class="text-left">JECFA</th>
																<th class="text-left">GMO</th>
																<th class="text-left">Flavor Status</th>
																<th class="text-left">Hydrogenation</th>
																<th class="text-left">VIPD Status</th>
															</tr>
														</thead>
													</table>
												</div>

												<h5>Regulation Info</h5>
												<hr />
												<div class="form-group row">
													<label class="col-sm-2 col-form-label control-label">Regulation
														Name</label>
													<div class="row col-sm-10">
														<label class="col-form-label">:</label>
														<div class="col">
															<a id="ingRegName" class="form-control-plaintext"></a>
														</div>
													</div>
												</div>
												<div class="form-group row formGap">
													<label class="col-sm-2 col-form-label control-label">Reference
														URL</label>
													<div class="row col-sm-10">
														<label class="col-form-label">:</label>
														<div class="col">
															<a id="ingRegRefUrl1" class="form-control-plaintext"></a>
														</div>
													</div>
												</div>
												<div class="form-group row formGap">
													<label class="col-sm-2 col-form-label control-label"></label>
													<div class="row col-sm-10">
														<label class="col-form-label">:</label>
														<div class="col">
															<a id="ingRegRefUrl2" class="form-control-plaintext"></a>
														</div>
													</div>
												</div>
												<div class="form-group row formGap">
													<label class="col-sm-2 col-form-label control-label"></label>
													<div class="row col-sm-10">
														<label class="col-form-label">:</label>
														<div class="col">
															<a id="ingRegRefUrl3" class="form-control-plaintext"></a>
														</div>
													</div>
												</div>
												<div class="form-group row formGap">
													<label class="col-sm-2 col-form-label control-label"></label>
													<div class="row col-sm-10">
														<label class="col-form-label">:</label>
														<div class="col">
															<a id="ingRegRefUrl4" class="form-control-plaintext"></a>
														</div>
													</div>
												</div>
												<div class="form-group row formGap">
													<label class="col-sm-2 col-form-label control-label"></label>
													<div class="row col-sm-10">
														<label class="col-form-label">:</label>
														<div class="col">
															<a id="ingRegRefUrl5" class="form-control-plaintext"></a>
														</div>
													</div>
												</div>

												<div class="form-group row formGap">
													<label class="col-sm-2 col-form-label control-label">Remark</label>
													<div class="row col-sm-10">
														<label class="col-form-label">:</label>
														<div class="col">
															<a id="ingRegRemark" class="form-control-plaintext"></a>
														</div>
													</div>
												</div>
												<h5>Regulation File</h5>
												<hr />

												<div class="tableFixHead">
													<table class="table table-bordered" id="ingRegFileTable">
														<thead>
															<tr>
																<th width="40px"><input type="checkbox"
																	id="checkAll"></th>
																<th class="text-left">File Group</th>
																<th class="text-left">File Category</th>
																<th class="text-left">File Name</th>
															</tr>
														</thead>
													</table>
												</div>

											</div>
											<div class="modal-footer">
												<button type="button" class="btn btn-primary"
													style="width: 70px;" onclick="onRegulationSave()"
													id="btnRegSave">Save</button>
												<button type="button" class="btn btn-secondary"
													data-dismiss="modal">Close</button>
											</div>
										</div>
									</div>
								</div>

							</form>
						</div>
					</div>

					<div class="form-group row" th:if="${createdInfo}">
						<div class="row col-sm-12">
							<div class="col">
								<a style="float: left;" th:text="${createdInfo}"></a> <a
									style="float: right; margin-right: -30px;"
									th:text="${modifiedInfo}"></a>
							</div>
						</div>
					</div>
					<div th:if="${screenMode == 'add'}">
						<br />
					</div>
					<div th:if="${screenMode == 'edit'}">
						<br />
					</div>

					<div style="margin-bottom: 20px;">
						<a class="btn btn-primary" type="button" id="btnAudit"
							style="width: 110px;"
							th:href="@{/base/audit/activityLogList(prId=${prId})}">Activity Log</a>
						<button class="btn btn-primary dropdown-toggle" type="button"
							style="width: 90px;" id="btnAction" data-toggle="dropdown"
							aria-haspopup="true" aria-expanded="false"
							th:hidden="${btnAction}">Action</button>
						<div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
							<button class="dropdown-item btn" type="submit" form="mainForm"
								th:hidden="${btnEdit}" id="btnEdit" value="edit" name="action">Edit</button>
							<button class="dropdown-item btn" type="button"
								data-toggle="modal" data-target="#saveConfirmDialog"
								th:hidden="${btnSaveSts}" id="btnSave" th:text="${btnSave}"></button>
							<button class="dropdown-item btn" type="button"
								onclick="onSubmitClick()" th:hidden="${btnSubmit}">Submit</button>
							<button class="dropdown-item btn" type="button"
								th:hidden="${btnReject}" id="btnReject" data-toggle="modal"
								data-target="#rejectModal">Reject</button>
							<button class="dropdown-item btn" type="button"
								th:hidden="${btnRework}" id="btnRework" data-toggle="modal"
								data-target="#reworkModal">Rework</button>
						</div>

						<a class="btn btn-primary" style="width: 90px;" type="button"
							id="btnViewCancel" data-toggle="modal"
							data-target="#cancelConfirmDialog"
							th:href="@{/main/product/productList}">Cancel</a> <a
							class="btn btn-primary" style="width: 90px;" type="button"
							hidden="true" id="btnEditCancel" data-toggle="modal"
							data-target="#cancelEditConfirmDialog"
							th:href="@{/main/product/productFormView(prId=${prId})}">Cancel</a>
						<button class="btn btn-primary"
							style="width: 100px; float: right;" type="button" id="btnNext">Next
							Step</button>

						<!-- FSGS) Hani 4/3/2021 Add/changed - Add cancel confirm dialog START -->
						<div class="modal fade" id="cancelConfirmDialog" tabindex="-1"
							role="dialog" aria-hidden="true">
							<div class="modal-dialog modal-dialog-centered" role="document">
								<div class="modal-content">
									<div class="modal-header">
										<h5 class="modal-title">Cancel Confirmation</h5>
										<button type="button" class="close" data-dismiss="modal"
											aria-label="Close">
											<span aria-hidden="true">&times;</span>
										</button>
									</div>
									<div class="modal-body">
										<span th:if="${screenMode == 'add'}">Are you sure to
											cancel this record?</span> <span
											th:if="${screenMode == 'view'}">Are you sure to go
											back to Product Recipe Listing?</span>
									</div>
									<div class="modal-footer">
										<button type="submit" class="btn btn-primary"
											onclick="onCancel()">Confirm</button>
										<button type="button" class="btn btn-secondary"
											data-dismiss="modal">Cancel</button>
									</div>
								</div>
							</div>
						</div>
						<!-- FSGS) Hani 4/3/2021 Add/changed - Add cancel confirm dialog END -->

						<!-- FSGS) Hani 5/3/2021 Add/changed - Add cancel edit confirm dialog START -->
						<div class="modal fade" id="cancelEditConfirmDialog" tabindex="-1"
							role="dialog" aria-hidden="true">
							<div class="modal-dialog modal-dialog-centered" role="document">
								<div class="modal-content">
									<div class="modal-header">
										<h5 class="modal-title">Cancel Confirmation</h5>
										<button type="button" class="close" data-dismiss="modal"
											aria-label="Close">
											<span aria-hidden="true">&times;</span>
										</button>
									</div>
									<div class="modal-body">Are you sure to cancel editing
										this record?</div>
									<div class="modal-footer">
										<button type="submit" class="btn btn-primary"
											onclick="onCancelEdit()">Confirm</button>
										<button type="button" class="btn btn-secondary"
											data-dismiss="modal">Cancel</button>
									</div>
								</div>
							</div>
						</div>
						<!-- FSGS) Hani 5/3/2021 Add/changed - Add cancel edit confirm dialog END -->

						<div class="modal fade" id="saveConfirmDialog" tabindex="-1"
							role="dialog" aria-hidden="true">
							<div class="modal-dialog modal-dialog-centered" role="document">
								<div class="modal-content">
									<div class="modal-header">
										<h5 class="modal-title">Save Confirmation</h5>
										<button type="button" class="close" data-dismiss="modal"
											aria-label="Close">
											<span aria-hidden="true">&times;</span>
										</button>
									</div>
									<div class="modal-body">Are you sure to save this
										record?</div>
									<div class="modal-footer">
										<button type="submit" class="btn btn-primary" form="mainForm"
											value="save" name="action">Confirm</button>
										<button type="button" class="btn btn-secondary"
											data-dismiss="modal">Cancel</button>
									</div>
								</div>
							</div>
						</div>

						<div class="modal fade" id="submitConfirmDialog" tabindex="-1"
							role="dialog" aria-hidden="true">
							<div class="modal-dialog modal-dialog-centered" role="document">
								<div class="modal-content">
									<div class="modal-header">
										<h5 class="modal-title">Submit Confirmation</h5>
										<button type="button" class="close" data-dismiss="modal"
											aria-label="Close">
											<span aria-hidden="true">&times;</span>
										</button>
									</div>
									<div class="modal-body">Are you sure to submit this
										record?</div>
									<div class="modal-footer">
										<button type="submit" class="btn btn-primary" form="mainForm"
											value="submit" name="action">Confirm</button>
										<button type="button" class="btn btn-secondary"
											data-dismiss="modal">Cancel</button>
									</div>
								</div>
							</div>
						</div>

						<div class="modal fade" id="alertDialog" tabindex="-1"
							role="dialog" aria-hidden="true">
							<div class="modal-dialog modal-dialog-centered" role="document">
								<div class="modal-content">
									<div class="modal-header">
										<h5 class="modal-title">
											<a id="alertTitle"></a>
										</h5>
										<button type="button" class="close" data-dismiss="modal"
											aria-label="Close">
											<span aria-hidden="true">&times;</span>
										</button>
									</div>
									<div class="modal-body">
										<a id="alertText"></a>
									</div>
									<div class="modal-footer">
										<button type="button" class="btn btn-secondary"
											data-dismiss="modal">Close</button>
									</div>
								</div>
							</div>
						</div>

					</div>
				</div>
			</main>
		</div>
	</div>

	<script type="text/javascript" src="../../js/scripts.js"></script>

	<script type="text/javascript">

		function onPageLoad() {
			setProdInfo();
			onCategoryChange();
			preventChar();

			var currTab = "[(${currTab})]";
			var screenPos = "[(${screenPosition})]";

			if (currTab === "productRecipe") {
				$('#tab a[href="#productRecipeTab"]').tab('show');

				if (screenPos === "bottom") {
					document.documentElement.scrollTop = 1000;
				}
			}

			if (currTab === "summary") {
				$('#tab a[href="#summaryTab"]').tab('show');
			}

			if (currTab === "qaFinalChecker") {
				$('#tab a[href="#qaFinalCheckerTab"]').tab('show');

				onFinalStatusChange();
				if (screenPos === "bottom") {
					document.documentElement.scrollTop = 1000;
				}
			}

			if (currTab === "foodAdditive") {
				$('#tab a[href="#foodAdditiveTab"]').tab('show');
			}

			if (currTab === "finalDecision") {
				$('#tab a[href="#finalDecisionTab"]').tab('show');
				$("#newSearchPlace").html($(".dataTables_filter"));
				$('#classModal').modal('show');
				onInitFinalDecision();
			}

			if (currTab === "attachment") {
				$('#tab a[href="#attachTab"]').tab('show');
			}

			var screenMode = "[(${screenMode})]";

			if (screenMode === "add") {
				enabledField();
				document.getElementById("btnAudit").hidden = true;
				document.getElementById("btnRegSave").hidden = false;
				document.getElementById("checkAll").disabled = false;
				document.getElementById("lblTSNos").hidden = true;
				document.getElementById("lblAltNames").hidden = true;
				//document.getElementById("recipeNo").removeAttribute("readonly");

				//$("#recipeNo").addClass("form-control");
				//$("#recipeNo").removeClass("form-control-plaintext");
				
				screenClassControl("form-control", "form-control-plaintext");
			} else if (screenMode === "edit") {
				enabledField();
				//document.getElementById("prodAsterisk").hidden = true;
				document.getElementById("btnProductAdd").disabled = false;
				document.getElementById("btnPrStatAdd").disabled = false;
				document.getElementById("btnFoodAdditiveAdd").disabled = false;
				document.getElementById("btnAttachAdd").disabled = false;
				document.getElementById("btnEditCancel").hidden = false;
				document.getElementById("btnViewCancel").hidden = true;
				document.getElementById("btnRegSave").hidden = false;
				document.getElementById("checkAll").disabled = false;
				document.getElementById("lblTSNos").hidden = true;
				document.getElementById("lblAltNames").hidden = true;

				//$("#recipeNo").addClass("form-control-plaintext");
				//$("#recipeNo").removeClass("form-control");
				screenClassControl("form-control", "form-control-plaintext");
			} else if (screenMode === "view") {
				//document.getElementById("prodAsterisk").hidden = true;
				document.getElementById("btnRegSave").hidden = true;
				document.getElementById("checkAll").disabled = true;

				//$("#recipeNo").addClass("form-control-plaintext");
				//$("#recipeNo").removeClass("form-control");
				screenClassControl("form-control-plaintext", "form-control");
			}
		}

		function preventChar() {
			var inputBox = document.getElementById("totalPercentage");
			var inputBox2 = document.getElementById("ingPercentage");

			var invalidChars = [ "-", "+", "e" ];

			inputBox.addEventListener("keydown", function(e) {
				if (invalidChars.includes(e.key)) {
					e.preventDefault();
				}
			});

			inputBox2.addEventListener("keydown", function(e) {
				if (invalidChars.includes(e.key)) {
					e.preventDefault();
				}
			});
		}

		// FSGS) Hani 4/3/2021 Add/changed - Add cancel confirm dialog START
		function onCancel() {
			window.location = "[[@{/main/product/productList}]]";
		}
		// FSGS) Hani 4/3/2021 Add/changed - Add cancel confirm dialog END

		// FSGS) Hani 5/3/2021 Add/changed - Add cancel edit confirm dialog START
		function onCancelEdit() {
			window.location = "[[@{/main/product/productFormView(prId=${prId})}]]";
		}
		// FSGS) Hani 5/3/2021 Add/changed - Add cancel edit confirm dialog END

		function screenClassControl(add, remove) {
			// Product Recipe Tab
			$("#prodName").addClass(add);
			$("#prodName").removeClass(remove);
			$("#recipeNo").addClass(add);
			$("#recipeNo").removeClass(remove);
			$("#otherName1").addClass(add);
			$("#otherName1").removeClass(remove);
			$("#otherName2").addClass(add);
			$("#otherName2").removeClass(remove);
			$("#otherName3").addClass(add);
			$("#otherName3").removeClass(remove);
			$("#otherName4").addClass(add);
			$("#otherName4").removeClass(remove);
			$("#otherName5").addClass(add);
			$("#otherName5").removeClass(remove);
			$("#ingPercentage").addClass(add);
			$("#ingPercentage").removeClass(remove);

			// QA Final Checker Tab
			var finalChecker = document
					.getElementsByName("remarksQaFinalChecker");
			if (finalChecker !== null) {
				for (var i = 0; i < finalChecker.length; i++) {
					finalChecker[i].classList.add(add);
					finalChecker[i].classList.remove(remove);
				}
			}

			// Food Additive Tab
			$("#foodAdditiveFunc").addClass(add);
			$("#foodAdditiveFunc").removeClass(remove);
			
			// Remark Tab
			$("#remark").addClass(add);
			$("#remark").removeClass(remove);

			// Attach Tab
			$("#attachTitle").addClass(add);
			$("#attachTitle").removeClass(remove);
		}

		function enabledField() {
			// Product Recipe Tab
			document.getElementById("recipeNo").disabled = false;
			document.getElementById("prodName").disabled = false;
			document.getElementById("otherName1").disabled = false;
			document.getElementById("otherName2").disabled = false;
			document.getElementById("otherName3").disabled = false;
			document.getElementById("otherName4").disabled = false;
			document.getElementById("otherName5").disabled = false;
			document.getElementById("rawMaterialCat").disabled = false;
			document.getElementById("productRecipeCat").disabled = false;
			document.getElementById("rmName").disabled = false;
			document.getElementById("prdName").disabled = false;
			document.getElementById("rmTsNo").hidden = false;
			document.getElementById("altRm").hidden = false;
			document.getElementById("ingPercentage").disabled = false;

			// Food Additive Tab
			document.getElementById("ingredientName").disabled = false;
			document.getElementById("foodAdditiveFunc").disabled = false;

			// QA Final Checker Tab
			document.getElementById("prStatCountryId").disabled = false;

			var finalChecker = document
					.getElementsByName("remarksQaFinalChecker");
			if (finalChecker !== null) {
				for (var i = 0; i < finalChecker.length; i++) {
					finalChecker[i].disabled = false;
				}
			}

			var finalStatus = document.getElementsByName("finalStatus");
			if (finalStatus !== null) {
				for (var i = 0; i < finalStatus.length; i++) {
					finalStatus[i].disabled = false;
				}
			}
			
			// Remark Tab
			document.getElementById("remark").disabled = false;

			// Attach Tab
			document.getElementById("attachTitle").disabled = false;
			document.getElementById("attachCategory").disabled = false;
			document.getElementById("attachFile").disabled = false;
			document.getElementById("attachFile").hidden = false;
			document.getElementById("attachFileLabel").hidden = false;
		}

		function onInitPrdRcp() {
			document.getElementById("btnNext").hidden = false;
		}

		function onInitSummary() {
			setProdInfo();
			document.getElementById("btnNext").hidden = false;
		}

		function onInitQAFinalChecker() {
			setProdInfo();
			document.getElementById("btnNext").hidden = false;
		}

		function onInitFoodAdditive() {
			setProdInfo();
			document.getElementById("btnNext").hidden = false;
		}

		function onInitFinalDecision() {
			setProdInfo();
			document.getElementById("btnNext").hidden = false;
		}

		function onInitAttach() {
			setProdInfo();
			document.getElementById("btnNext").hidden = false;
		}
		
		function onInitRemark() {
			setProdInfo();
			document.getElementById("btnNext").hidden = true;
		}

		function onFinalStatusChange() {
			var finalStatus = document.getElementsByName("finalStatus");
			if (finalStatus !== null) {
				var notPermitted = false;
				var notSure = false;
				for (var i = 0; i < finalStatus.length; i++) {
					if (finalStatus[i].value == 0 || finalStatus[i].value == 2
							|| finalStatus[i].value == 4) {
						notPermitted = true;
					}
					
					if (finalStatus[i].value == 3) {
						notSure = true;
					}
				}

				if (notPermitted) {
					document.getElementById("prAutoStatus").value = "Not Permitted";
				} else if (!notPermitted && notSure) {
					document.getElementById("prAutoStatus").value = "Not Sure";
				} else {
					document.getElementById("prAutoStatus").value = "Permitted";
				}
			}
		}

		function onCategoryChange() {
			var productCat = document.getElementsByName("productCat");
			for (var i = 0; i < productCat.length; i++) {
				if (productCat[i].checked) {
					if (productCat[i].value === "201") {
						document.getElementById("rmName").hidden = false;
						document.getElementById("prdName").hidden = true;
						document.getElementById("prdName").value = 0;
						document.getElementById("tsNoGroup").hidden = false;

					} else {
						document.getElementById("rmName").hidden = true;
						document.getElementById("rmName").value = 0;
						document.getElementById("prdName").hidden = false;
						document.getElementById("tsNoGroup").hidden = false;

					}
				}
			}
		}

		// FSGS) KarVei 26/2/2021 Add - Show RM / PR search modal
		function onSearchModel() {
			var productCat = document.getElementsByName("productCat");
		
			for (var i = 0; i < productCat.length; i++) {
				if (productCat[i].checked) {
					if (productCat[i].value === "201") {
						$('#rmSearchModal').modal('show');
						//Search function for rmSearchModal
						$(document).ready(function() {
							$("#rmInputSearch").on("keyup",function() {
								var value = $(this).val().toLowerCase();
								$("#rmTable tr").filter(function() {
									$(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
								});
							});
						});
					} else {
						$('#prSearchModal').modal('show');
						//Search function for prSearchModal
						$(document).ready(function() {
							$("#prInputSearch").on("keyup",function() {
								var value = $(this).val().toLowerCase();
								$("#prTable tr").filter(function() {
									$(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
								});
							});
						});
					}
				}
			}
		}

		function onProductNameClick(matlName) {
			var screenMode = "[(${screenMode})]";
			var prCode = document.getElementById("recipeNo").value;
			var countryId = document.getElementById("prStatCountryId").value;
			var countryStatus = document.getElementById("prAutoStatus").value;

			document.getElementById("checkAll").checked = false;
			document.getElementById("rawMatlReg").text = matlName;
			document.getElementById("rawMatlIng").text = matlName;
			document.getElementById("rawMatlRegFinal").text = countryStatus;
			
			var ctx = "[[@{/}]]"; /*20210519 - do not hard-code context path*/

			if (countryId) {
				$
						.ajax({
							url : ctx+"main/product/productFormIngReg?rawMatlName="
									+ matlName
									+ "&countryId="
									+ countryId
									+ "&prCode=" + prCode,
							type : "GET",
							success : function(data) {
								document.getElementById("rawMatlRegCountry").text = data.countryName;

								var prTable = document
										.getElementById("ingRegTable");
								var regTable = document
										.getElementById("ingRegFileTable");
								var rmManfItems = data.rmManfItems;
								var rmItems = data.rawMatlItems;
								var ingRegItems = data.ingRegItems;
								var ingRegFileItems = data.ingRegFileItems;
								var prRmRegItems = data.prRmRegItems;

								var rowCount = prTable.rows.length;
								for (var i = 1; i < rowCount; i++) {
									prTable.deleteRow(1);
								}

								var rowCount = regTable.rows.length;
								for (var i = 1; i < rowCount; i++) {
									regTable.deleteRow(1);
								}

								for ( var x in rmManfItems) {
									var row = prTable.insertRow(1);
									var cell1 = row.insertCell(0);
									var cell2 = row.insertCell(1);
									var cell3 = row.insertCell(2);
									var cell4 = row.insertCell(3);
									var cell5 = row.insertCell(4);
									var cell6 = row.insertCell(5);
									var cell7 = row.insertCell(6);
									var cell8 = row.insertCell(7);
									var cell9 = row.insertCell(8);
									var cell10 = row.insertCell(9);

									cell1.innerHTML = rmManfItems[x].tsNo;
									cell2.innerHTML = matlName;
									cell3.innerHTML = rmItems.insNo;
									cell4.innerHTML = rmItems.eno;
									cell5.innerHTML = rmItems.femaNo;
									cell6.innerHTML = rmItems.jecfaNo;
									cell7.innerHTML = rmItems.gmoStatus;
									cell8.innerHTML = rmItems.flavorStatus;
									cell9.innerHTML = rmItems.phoFlag;
									cell10.innerHTML = rmManfItems[x].manfRecStatus;
								}

								if (ingRegItems) {
									document.getElementById("ingRegName").text = ingRegItems[0].regName
								}

								if (ingRegItems) {
									if (ingRegItems[0].refUrl1) {
										document
												.getElementById("ingRegRefUrl1").text = ingRegItems[0].refUrl1;
									}
									if (ingRegItems[0].refUrl2) {
										document
												.getElementById("ingRegRefUrl2").text = ingRegItems[0].refUrl2;
									}
									if (ingRegItems[0].refUrl3) {
										document
												.getElementById("ingRegRefUrl3").text = ingRegItems[0].refUrl3;
									}
									if (ingRegItems[0].refUrl4) {
										document
												.getElementById("ingRegRefUrl4").text = ingRegItems[0].refUrl4;
									}
									if (ingRegItems[0].refUrl5) {
										document
												.getElementById("ingRegRefUrl5").text = ingRegItems[0].refUrl5;
									}

									if (ingRegItems[0].remarks) {
										document.getElementById("ingRegRemark").text = ingRegItems[0].remarks
									}

									for ( var i in ingRegFileItems) {
										var row = regTable.insertRow(1);
										var cell1 = row.insertCell(0);
										var cell2 = row.insertCell(1);
										var cell3 = row.insertCell(2);
										var cell4 = row.insertCell(3);

										var docFound = "";
										if (prRmRegItems) {
											for ( var a in prRmRegItems) {
												if (prRmRegItems[a].regDocId == ingRegFileItems[i].reglFileId) {
													docFound = "checked";
												}
											}
										}

										var disabledBox = "";
										if (screenMode === "view") {
											disabledBox = "disabled"
										}

										cell1.innerHTML = '<input type="checkbox" name="tableRow" ' + docFound + ' ' + disabledBox 
						    						+ ' value=' + ingRegFileItems[i].reglFileId + '></input>';
										cell2.innerHTML = ingRegFileItems[i].fgroup;
										cell3.innerHTML = ingRegFileItems[i].fcategory;
										cell4.innerHTML = ingRegFileItems[i].fileName;
									}

								} else {
									document.getElementById("ingRegName").text = "";
									document.getElementById("ingRegRefUrl1").text = "";
									document.getElementById("ingRegRefUrl2").text = "";
									document.getElementById("ingRegRefUrl3").text = "";
									document.getElementById("ingRegRefUrl4").text = "";
									document.getElementById("ingRegRefUrl5").text = "";
									document.getElementById("ingRegRemark").text = "";
								}

								$('#rawMatlRegulationModal').modal('show');
							}
						});
			} else {
				document.getElementById("alertTitle").text = "Alert";
				document.getElementById("alertText").text = "Please select any country!";
				$('#alertDialog').modal('show');
			}
		}

		function onRegulationSave() {
			var prCode = document.getElementById("recipeNo").value;
			var rawMatlName = document.getElementById("rawMatlIng").text;
			var countryId = document.getElementById("prStatCountryId").value;

			var checkedRow = [];
			var tableRow = document.getElementsByName("tableRow");
			for (var i = 0; i < tableRow.length; i++) {
				if (tableRow[i].checked) {
					checkedRow.push(tableRow[i].value);
				}
			}

			var ctx = "[[@{/}]]"; /*20210519 - do not hard-code context path*/
			if (checkedRow.length !== 0) {
				$.ajax({
					url : ctx+"main/product/productFormSaveReg?id="
							+ checkedRow + "&rawMatlName=" + rawMatlName
							+ "&countryId=" + countryId + "&prCode=" + prCode,
					type : "GET",
					success : function(data) {
					}
				});
			}

			$('#rawMatlRegulationModal').modal('hide');
		}

		function onCountryChange() {
			updCurrTab("qaFinalChecker");
			document.getElementById("mainForm").submit();
		}

		function onRmChange() {
			updCurrTab("productRecipe");

			//document.getElementById("rmTsNo").hidden = true;
			//document.getElementById("altRm").hidden = true;
			document.getElementById("tsNoLoader").hidden = false;

			document.getElementById("mainForm").submit();
		}

		function updCurrTab(currTab) {
			$.ajax({
				url : "[[@{/main/product/productFormUpdTab?tab=}]]"
						+ currTab,
				type : "GET"
			});
		}

		function onSubmitClick() {
			$.ajax({
				url : "[[@{/main/product/productFormCheckRole}]]",
				type : "GET",
				success : function(data) {
					var userRole = data.role;

					if (userRole === "hod") {
						var countryData = data.countryData;
						var screenMode = data.screenMode;
						var hodStatusTable = document
								.getElementById("hodStatusTable");
						var rowCount = hodStatusTable.rows.length;

						for (var i = 1; i < rowCount; i++) {
							if (screenMode === "add") {
								hodStatusTable.rows[i].cells[2].innerHTML = hodStatusTable.rows[i].cells[1].innerHTML;
							} else {
								for ( var x in countryData) {
									if (hodStatusTable.rows[i].cells[0].innerHTML === countryData[x].cntryName) {
										hodStatusTable.rows[i].cells[2].innerHTML = countryData[x].finalStatusDesc;
									}
								}
							}
						}

						$('#hodRemarkModal').modal('show');
					} else {
						$('#submitConfirmDialog').modal('show');
					}
				}
			});
		}

		function setProdInfo() {
			var recipeNoDisp = document.getElementsByName("recipeNoDisplay");
			var prodNameDisp = document.getElementsByName("prodNameDisplay");
			var totalPercentageDisp = document
					.getElementsByName("totalPercentageDisplay");
			for ( var x in recipeNoDisp) {
				recipeNoDisp[x].value = document.getElementById("recipeNo").value;
			}
			for ( var x in prodNameDisp) {
				var combineName = document.getElementById("prodName").value;

				if (document.getElementById("otherName1").value) {
					combineName = combineName + " / "
							+ document.getElementById("otherName1").value
				}

				if (document.getElementById("otherName2").value) {
					combineName = combineName + " / "
							+ document.getElementById("otherName2").value
				}

				if (document.getElementById("otherName3").value) {
					combineName = combineName + " / "
							+ document.getElementById("otherName3").value
				}

				if (document.getElementById("otherName4").value) {
					combineName = combineName + " / "
							+ document.getElementById("otherName4").value
				}

				if (document.getElementById("otherName5").value) {
					combineName = combineName + " / "
							+ document.getElementById("otherName5").value
				}

				prodNameDisp[x].value = combineName;
			}
			for ( var x in totalPercentageDisp) {
				totalPercentageDisp[x].value = document
						.getElementById("totalPercentage").value;
			}
		}

		$('#checkAll').on('click', function() {
			var tableRow = document.getElementsByName("tableRow");
			if (document.getElementById("checkAll").checked) {
				for (var i = 0; i < tableRow.length; i++) {
					tableRow[i].checked = true;
				}
			} else {
				for (var i = 0; i < tableRow.length; i++) {
					tableRow[i].checked = false;
				}
			}
		});

		$('#btnNext').click(
				function(e) {
					e.preventDefault();
					$('.nav-tabs .active').parent().next('li').find('a')
							.trigger('click');
					document.documentElement.scrollTop = 0;
				});

		$(".custom-file-input").on(
				"change",
				function() {
					var fileName = $(this).val().split("\\").pop();
					$(this).siblings(".custom-file-label").addClass("selected")
							.html(fileName);
				});

		$(document).ready(function() {
			$("input[type=submit]").click(function() {
				console.log($("#productAction").val($(this).val()));

			});
		});

		var attachFile = document.getElementById("attachFile");

		attachFile.onchange = function() {
			if (this.files[0].size > 104857600) {
				this.value = "";
				document.getElementById("attachFileLabel").innerHTML = "Choose file";

				showAlert(1);
			} else {
				if (!checkExt(this.value)) {
					showAlert(2);
					this.value = "";
					document.getElementById("attachFileLabel").innerHTML = "Choose file";
				}
			}
		};
		
		
		function openPopupForm(mId) {
			var idx = mId.split(" ")[0];
			var type = mId.split(" ")[1];
			var ctx = "[[@{/}]]";
			var url = "main/material/viewRmForm?matlId=" + idx;
			if (type === "301")
				url = "main/product/viewPrForm?prId=" + idx;

			window.open(ctx + url, '_blank', '');
		}
	</script>
</body>
</html>